"use strict";(self.webpackChunkconstellaxion_docs=self.webpackChunkconstellaxion_docs||[]).push([[8409],{8116:(e,n,s)=>{s.r(n),s.d(n,{Table:()=>d,assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>t,metadata:()=>i,policies:()=>c,toc:()=>h});const i=JSON.parse('{"id":"cloud-setup/aws","title":"Working with AWS","description":"Constellaxion supports deploying and fine-tuning open-source models on AWS using services like SageMaker, ECR, and S3.","source":"@site/versioned_docs/version-0.4.0/cloud-setup/aws.md","sourceDirName":"cloud-setup","slug":"/cloud-setup/aws","permalink":"/constellaxion.github.io/docs/cloud-setup/aws","draft":false,"unlisted":false,"tags":[],"version":"0.4.0","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Cloud Setup","permalink":"/constellaxion.github.io/docs/category/cloud-setup"},"next":{"title":"Working with GCP","permalink":"/constellaxion.github.io/docs/cloud-setup/gcp"}}');var o=s(4848),l=s(8453);const t={sidebar_position:1},r="Working with AWS",a={},c=[{name:"AmazonSageMakerFullAccess",purpose:"To create, manage, and monitor training and endpoint jobs"},{name:"AmazonEC2ContainerRegistryFullAccess",purpose:"To push/pull Docker images for custom training and inference containers"},{name:"AmazonS3FullAccess",purpose:"To read/write training data and model artifacts"}],d=()=>(0,o.jsxs)("table",{style:{fontFamily:"Monospace"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Policy"}),(0,o.jsx)("th",{children:"Purpose"})]})}),(0,o.jsx)("tbody",{children:c.map((e=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:{fontWeight:"bold"},children:e.name}),(0,o.jsx)("td",{children:e.purpose})]},e.name)))})]}),h=[{value:"What Constellaxion Does on AWS",id:"what-constellaxion-does-on-aws",level:2},{value:"\ud83d\udd10 IAM Role: <code>constellaxion-admin</code>",id:"-iam-role-constellaxion-admin",level:2},{value:"\ud83d\udee0\ufe0f Role Trust Policy",id:"\ufe0f-role-trust-policy",level:3},{value:"\u2705 Attached Policies",id:"-attached-policies",level:3},{value:"\ud83e\udde9 Inline Policy for ECR Runtime Access",id:"-inline-policy-for-ecr-runtime-access",level:3},{value:"\ud83d\udc64 Your User Permissions",id:"-your-user-permissions",level:3},{value:"\ud83c\udf0d Region Support",id:"-region-support",level:3},{value:"\ud83d\udee0\ufe0f Summary: What Happens When You Run init",id:"\ufe0f-summary-what-happens-when-you-run-init",level:3},{value:"\ud83e\uddea Next Steps",id:"-next-steps",level:3}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"working-with-aws",children:"Working with AWS"})}),"\n","\n","\n",(0,o.jsxs)(n.p,{children:["Constellaxion supports deploying and fine-tuning open-source models on AWS using services like ",(0,o.jsx)(n.strong,{children:"SageMaker"}),", ",(0,o.jsx)(n.strong,{children:"ECR"}),", and ",(0,o.jsx)(n.strong,{children:"S3"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"This page explains what IAM resources the CLI sets up under the hood to enable this functionality, and what permissions are required to run it from your local machine."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"what-constellaxion-does-on-aws",children:"What Constellaxion Does on AWS"}),"\n",(0,o.jsxs)(n.p,{children:["When you run a commands like ",(0,o.jsx)(n.code,{children:"constellaxion init"}),", or ",(0,o.jsx)(n.code,{children:"constellaxion model deploy"}),", Constellaxion performs a series of actions behind the scenes to enable the right AWS resources to handle the job. Some examples of what Constellaxion might do:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Launch training jobs via ",(0,o.jsx)(n.strong,{children:"SageMaker"})]}),"\n",(0,o.jsxs)(n.li,{children:["Push/pull custom containers using ",(0,o.jsx)(n.strong,{children:"ECR"})]}),"\n",(0,o.jsxs)(n.li,{children:["Read/write datasets and model artifacts in ",(0,o.jsx)(n.strong,{children:"S3"})]}),"\n",(0,o.jsx)(n.li,{children:"Create and configure IAM roles automatically"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"These actions require specific IAM permissions in your AWS account."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.h2,{id:"-iam-role-constellaxion-admin",children:["\ud83d\udd10 IAM Role: ",(0,o.jsx)(n.code,{children:"constellaxion-admin"})]}),"\n",(0,o.jsxs)(n.p,{children:["After you run ",(0,o.jsx)(n.code,{children:"constellaxion init"}),", Constellaxion creates (or reuses) an IAM role named:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"constellaxion-admin\n"})}),"\n",(0,o.jsx)(n.p,{children:"This role is assumed by AWS services to carry out SageMaker training and ECS-based serving jobs."}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-role-trust-policy",children:"\ud83d\udee0\ufe0f Role Trust Policy"}),"\n",(0,o.jsx)(n.p,{children:"The role allows the following AWS services to assume it:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"sagemaker.amazonaws.com"})," \u2013 for training and inference"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ecs-tasks.amazonaws.com"})," \u2013 for serving (future support)"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Principal": {\n        "Service": [\n          "sagemaker.amazonaws.com",\n          "ecs-tasks.amazonaws.com"\n        ]\n      },\n      "Action": "sts:AssumeRole"\n    }\n  ]\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"-attached-policies",children:"\u2705 Attached Policies"}),"\n",(0,o.jsxs)(n.p,{children:["The following AWS-managed policies are automatically attached to the ",(0,o.jsx)(n.code,{children:"constellaxion-admin"})," role:"]}),"\n",(0,o.jsx)(d,{}),"\n",(0,o.jsx)(n.admonition,{title:"Security Note",type:"info",children:(0,o.jsxs)(n.p,{children:["This IAM approach is not ideal for production deployments. We're working on a more secure solution. If you have any urgent needs, please reach out to us at ",(0,o.jsx)(n.a,{href:"mailto:support@constellaxion.com",children:"support@constellaxion.com"}),"."]})}),"\n",(0,o.jsx)(n.h3,{id:"-inline-policy-for-ecr-runtime-access",children:"\ud83e\udde9 Inline Policy for ECR Runtime Access"}),"\n",(0,o.jsxs)(n.p,{children:["In addition to the managed policies, Constellaxion attaches a custom inline policy to the ",(0,o.jsx)(n.code,{children:"constellaxion-admin"})," role that explicitly grants ECR runtime access:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "Effect": "Allow",\n  "Action": [\n    "ecr:GetAuthorizationToken",\n    "ecr:BatchCheckLayerAvailability",\n    "ecr:GetDownloadUrlForLayer",\n    "ecr:BatchGetImage"\n  ],\n  "Resource": "*"\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"This ensures SageMaker and ECS tasks can pull your custom containers during job execution."}),"\n",(0,o.jsx)(n.h3,{id:"-your-user-permissions",children:"\ud83d\udc64 Your User Permissions"}),"\n",(0,o.jsx)(n.p,{children:"To initialize the AWS environment locally using Constellaxion, the identity running the CLI must be able to:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Create IAM roles and attach policies"}),"\n",(0,o.jsx)(n.li,{children:"Resolve the current identity using STS"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You'll need to ensure that the identity has the following permissions:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "Effect": "Allow",\n  "Action": [\n    "iam:CreateRole",\n    "iam:PutRolePolicy",\n    "iam:AttachRolePolicy",\n    "iam:GetRole",\n    "sts:GetCallerIdentity"\n  ],\n  "Resource": "*"\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"You can either grant these permissions directly or run the CLI as a user with AdministratorAccess."}),"\n",(0,o.jsx)(n.h3,{id:"-region-support",children:"\ud83c\udf0d Region Support"}),"\n",(0,o.jsxs)(n.p,{children:["Constellaxion supports any AWS region where SageMaker is available. Specify the region in your ",(0,o.jsx)(n.a,{href:"/constellaxion.github.io/docs/configure/model-yaml",children:"model.yaml"})," file under the ",(0,o.jsx)(n.code,{children:"deploy.aws.region"})," field."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"deploy:\n  aws:\n    region: us-east-1\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/general/latest/gr/sagemaker.html",children:"\ud83d\udc49 SageMaker Region guide"})}),"\n",(0,o.jsx)(n.h3,{id:"\ufe0f-summary-what-happens-when-you-run-init",children:"\ud83d\udee0\ufe0f Summary: What Happens When You Run init"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["The CLI calls ",(0,o.jsx)(n.code,{children:"sts:GetCallerIdentity"})," to determine who you are"]}),"\n",(0,o.jsxs)(n.li,{children:["It creates the ",(0,o.jsx)(n.code,{children:"constellaxion-admin"})," role (or skips if it already exists)"]}),"\n",(0,o.jsx)(n.li,{children:"It attaches the required managed policies"}),"\n",(0,o.jsx)(n.li,{children:"It adds the inline ECR access policy"}),"\n",(0,o.jsx)(n.li,{children:"You\u2019re ready to train or deploy!"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"-next-steps",children:"\ud83e\uddea Next Steps"}),"\n",(0,o.jsx)(n.p,{children:"Once AWS is set up:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Create a model directory with model.yaml"}),"\n",(0,o.jsxs)(n.li,{children:["Run ",(0,o.jsx)(n.code,{children:"constellaxion init"})]}),"\n",(0,o.jsx)(n.li,{children:"You\u2019re ready to deploy, fine-tune, and serve \ud83d\ude80"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>r});var i=s(6540);const o={},l=i.createContext(o);function t(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);